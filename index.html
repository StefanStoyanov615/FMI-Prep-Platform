<!doctype html>
<html lang="bg">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Архив Математика</title>
        <!-- ВАЖНО: Вече не е css/style.css, а само style.css -->
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <nav class="navbar">
            <a href="#" class="brand">FMI Prep Platform</a>
        </nav>

        <div class="container">
            <header class="hero">
                <h1>Платформа за подготовка за кандидастване във ФМИ</h1>
                <p>Бърз достъп до всички изпити и състезания, с които можеш да влезнеш във фми</p>
            </header>

            <!-- Секциите -->
            <section id="uni" class="archive-section">
                <h2 class="section-title">Кандидат-студентски изпити</h2>
                <div id="uni-grid" class="grid">Зареждане...</div>
            </section>

            <section id="dzi" class="archive-section">
                <h2 class="section-title">Държавни зрелостни изпити ПП</h2>
                <div id="dzi-grid" class="grid">Зареждане...</div>
            </section>

            <section id="boyanov" class="archive-section">
                <h2 class="section-title">Турнир "Проф. Б. Боянов"</h2>
                <div id="boyanov-grid" class="grid">Зареждане...</div>
            </section>

            <section id="olimpiadi" class="archive-section">
                <h2 class="section-title">Олимпиади</h2>
                <div id="olimpiadi-grid" class="grid">Зареждане...</div>
            </section>
        </div>

        <script>
            window.onload = async () => {
                try {
                    // ВАЖНО: Търсим файла в същата папка, не в data/
                    const response = await fetch("registry.json");
                    const data = await response.json();

                    populateGrid("uni-grid", data.ksi);
                    populateGrid("dzi-grid", data.dzi);
                    populateGrid("olimpiadi-grid", data.olimpiadi);
                    populateGrid("boyanov-grid", data.boyanov);
                } catch (error) {
                    console.error("Грешка:", error);
                    document.querySelector(".container").innerHTML =
                        "<h1>Грешка!</h1><p>Не мога да намеря файл <b>registry.json</b>. Уверете се, че е в същата папка като index.html</p>";
                }
            };

            function populateGrid(elementId, items) {
                const container = document.getElementById(elementId);

                if (!items || items.length === 0) {
                    container.innerHTML = "<p style='color:#777'>Няма налични материали.</p>";
                    return;
                }

                container.innerHTML = items
                    .map((item) => {
                        // Проверка дали има линк за отговори
                        const hasAnswers = item.url_answers && item.url_answers.trim() !== "";

                        return `
                <div class="card">
                    <div class="card-header">
                        <span class="card-year">${item.year}</span>
                        <div class="card-title">${item.title}</div>
                    </div>
                    
                    <div class="card-actions">
                        <!-- Бутон Условие -->
                        <a href="view.html?src=${encodeURIComponent(item.url_problems)}" 
                           class="btn-card btn-problem" 
                           target="_blank">
                           Условия
                        </a>

                        <!-- Бутон Отговори (показва се само ако има линк) -->
                        ${
                            hasAnswers
                                ? `<a href="view.html?src=${encodeURIComponent(item.url_answers)}" 
                                  class="btn-card btn-answer" 
                                  target="_blank">
                                  Отговори
                               </a>`
                                : ""
                        }
                    </div>
                </div>
                `;
                    })
                    .join("");
            }
        </script>
    </body>
</html>
